CREATE COMPRESSION_DICTIONARY d1('');
CREATE COMPRESSION_DICTIONARY d2(_ucs2'');
CREATE COMPRESSION_DICTIONARY d3('aaaaaaaabbbbbbbbccccccccdddddddd');
CREATE COMPRESSION_DICTIONARY d4(_ucs2'aaaaaaaabbbbbbbbccccccccdddddddd');
CREATE COMPRESSION_DICTIONARY d5(' ');
CREATE COMPRESSION_DICTIONARY d6('\0');
CREATE COMPRESSION_DICTIONARY d7('\0aaaaaaaabbbbbbbbccccccccdddddddd');
SET @dict_data8 = 'aaaaaaaabbbbbbbbccccccccdddddddd';
CREATE COMPRESSION_DICTIONARY d8(@dict_data8);
SET @dict_data9 = '';
CREATE COMPRESSION_DICTIONARY d9(@dict_data9);
SET @dict_data10 = 123;
CREATE COMPRESSION_DICTIONARY d10(@dict_data10);
SET @dict_data11 = STR_TO_DATE('02/29/2016', '%m/%d/%Y');
CREATE COMPRESSION_DICTIONARY d11(@dict_data11);
SET @dict_data12 = NULL;
CREATE COMPRESSION_DICTIONARY d12(@dict_data12);
CREATE COMPRESSION_DICTIONARY d12(@dict_data12 := 'blah');
ERROR 42000: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')' at line 1
SET @long_dictionary_name = REPEAT('d', 64);
CREATE COMPRESSION_DICTIONARY dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd('abcd');
CREATE COMPRESSION_DICTIONARY ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd('abcd');
ERROR HY000: Compression dictionary name 'ddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd' is too long (max length = 64)
SET @long_dictionary_data = REPEAT('ab', 32506 / 2);
CREATE COMPRESSION_DICTIONARY d13(@long_dictionary_data);
SET @longer_dictionary_data = CONCAT(@long_dictionary_data, 'a');
CREATE COMPRESSION_DICTIONARY d14(@longer_dictionary_data);
ERROR HY000: Data for compression dictionary 'd14' is too long (max length = 32506)
SELECT id, name, MD5(zip_dict), LENGTH(zip_dict)
FROM information_schema.xtradb_zip_dict
ORDER BY id;
id	name	MD5(zip_dict)	LENGTH(zip_dict)
1	d1	d41d8cd98f00b204e9800998ecf8427e	0
2	d2	d41d8cd98f00b204e9800998ecf8427e	0
3	d3	72dbd0ddead281f6bc7e550413de30d5	32
4	d4	4afea7d073863b9dbe80cfac0ba75d5a	16
5	d5	7215ee9c7d9dc229d2921a40e899ec5f	1
6	d6	93b885adfe0da089cdf634904fd59f71	1
7	d7	506cecad13db0f743abd3e9005013428	33
8	d8	72dbd0ddead281f6bc7e550413de30d5	32
9	d9	d41d8cd98f00b204e9800998ecf8427e	0
10	d10	202cb962ac59075b964b07152d234b70	3
11	d11	3accaabe743e73d754c5cb1616cd4be6	10
12	d12	d41d8cd98f00b204e9800998ecf8427e	0
13	dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd	e2fc714c4727ee9395f324cd2e7f331f	4
14	d13	bf0065e1594c247ded0d765c0af28dca	32506
SELECT zip_dict = 'abcd' AS short_zip_dict_data_must_match
FROM information_schema.xtradb_zip_dict
WHERE name = @long_dictionary_name;
short_zip_dict_data_must_match
1
SELECT zip_dict = @long_dictionary_data AS long_zip_dict_data_must_match
FROM information_schema.xtradb_zip_dict
WHERE name = 'd13';
long_zip_dict_data_must_match
1
CREATE COMPRESSION_DICTIONARY d1('data');
ERROR HY000: Compression dictionary 'd1' already exists
SELECT id INTO @dict_id FROM information_schema.xtradb_zip_dict
WHERE name = 'd1';
CREATE TABLE t1(
id INT,
a BLOB COLUMN_FORMAT COMPRESSED,
b BLOB COLUMN_FORMAT COMPRESSED WITH COMPRESSION_DICTIONARY d1
) ENGINE=InnoDB;
SELECT table_id INTO @table_id FROM information_schema.innodb_sys_tables
WHERE name=CONCAT(DATABASE(), '/', 't1');
SELECT COUNT(*) = 1 AS only_one_dictionary_reference FROM information_schema.xtradb_zip_dict_cols
WHERE table_id = @table_id;
only_one_dictionary_reference
1
SELECT dict_id = @dict_id AS dict_ids_must_match FROM information_schema.xtradb_zip_dict_cols
WHERE table_id = @table_id AND column_pos = 2;
dict_ids_must_match
1
SET @long_string_value = REPEAT('a', 128);
INSERT INTO t1 VALUES(1, @long_string_value, @long_string_value);
SELECT a = @long_string_value AS a_match, b = @long_string_value AS b_match FROM t1 WHERE id = 1;
a_match	b_match
1	1
DROP COMPRESSION_DICTIONARY d100;
ERROR HY000: Compression dictionary 'd100' does not exist
DROP COMPRESSION_DICTIONARY d1;
ERROR HY000: Compression dictionary 'd1' is in use
DROP COMPRESSION_DICTIONARY d13;
SELECT COUNT(*) = 0 AS dict_must_be_deleted
FROM information_schema.xtradb_zip_dict
WHERE name = 'd13';
dict_must_be_deleted
1
DROP COMPRESSION_DICTIONARY d2;
DROP COMPRESSION_DICTIONARY d3;
DROP COMPRESSION_DICTIONARY d4;
DROP COMPRESSION_DICTIONARY d5;
DROP COMPRESSION_DICTIONARY d6;
DROP COMPRESSION_DICTIONARY d7;
DROP COMPRESSION_DICTIONARY d8;
DROP COMPRESSION_DICTIONARY d9;
DROP COMPRESSION_DICTIONARY d10;
DROP COMPRESSION_DICTIONARY d11;
DROP COMPRESSION_DICTIONARY d12;
DROP COMPRESSION_DICTIONARY dddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddddd;
SELECT id, name, zip_dict, LENGTH(zip_dict)
FROM information_schema.xtradb_zip_dict;
id	name	zip_dict	LENGTH(zip_dict)
1	d1		0
DROP TABLE t1;
