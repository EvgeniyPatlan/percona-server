call mtr.add_suppression("last tracked LSN in");
# restart:--innodb_track_changed_pages=TRUE --innodb_log_file_size=5M --skip-stack-trace --skip-core-file
DROP TABLE IF EXISTS t1, t2;
CREATE TABLE t1 (x INT) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1),(2),(3),(4),(5);
INSERT INTO t1 VALUES (1),(2),(3),(4),(5);
INSERT INTO t1 VALUES (1),(2),(3),(4),(5);
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
INSERT INTO t1 SELECT x FROM t1;
CREATE TABLE t2 (x INT) ENGINE=InnoDB;
INSERT INTO t2 VALUES (1),(2),(3),(4),(5);
SET GLOBAL INNODB_FAST_SHUTDOWN=2;
1st restart
# restart:--innodb_track_changed_pages=TRUE --innodb_log_file_size=5M --skip-stack-trace --skip-core-file
ib_modified_log_1
ib_modified_log_2
2nd restart
# restart:--innodb_track_changed_pages=TRUE --innodb_log_file_size=5M --skip-stack-trace --skip-core-file -#d,crash_before_bitmap_write
INSERT INTO t1 SELECT x FROM t1;
ERROR HY000: Lost connection to MySQL server during query
INSERT INTO t1 VALUES (1),(2),(3),(4),(5);
ib_modified_log_1
ib_modified_log_2
ib_modified_log_3
DROP TABLE t1, t2;
